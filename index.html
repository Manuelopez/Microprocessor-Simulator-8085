<!DOCTYPE html>
<!--
Copyright 2018 The Go Authors. All rights reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file.
-->
<html>
  <head>
    <meta charset="utf-8" />
    <title>Go wasm</title>
  </head>

  <body>
    <script src="wasm_exec.js"></script>

    <script>
      function updateRegisters(
        al,
        ah,
        b,
        c,
        d,
        e,
        l,
        h,
        ir,
        mar,
        mbr,
        pc,
        mem,
        sp,
        stackMem
      ) {
        console.log(stackMem, 'here here here')
        console.log(sp, 'sp here here')
        requestAnimationFrame(() => {
          document.getElementById('al').innerHTML = al + ''
          document.getElementById('ah').innerHTML = ah + ''
          document.getElementById('b').innerHTML = b + ''
          document.getElementById('c').innerHTML = c + ''
          document.getElementById('d').innerHTML = d + ''
          document.getElementById('e').innerHTML = e + ''
          document.getElementById('l').innerHTML = l + ''
          document.getElementById('h').innerHTML = h + ''
          document.getElementById('ir').innerHTML = ir + ''
          document.getElementById('mar').innerHTML = mar + ''
          document.getElementById('mbr').innerHTML = mbr + ''
          document.getElementById('pc').innerHTML = pc + ''
          document.getElementById('mem').innerHTML = mem
          document.getElementById('sp').innerHTML = sp
          document.getElementById('smem').innerHTML = stackMem
        })
      }
      if (!WebAssembly.instantiateStreaming) {
        // polyfill
        WebAssembly.instantiateStreaming = async (resp, importObject) => {
          const source = await (await resp).arrayBuffer()
          return await WebAssembly.instantiate(source, importObject)
        }
      }

      const go = new Go()

      let mod, inst

      WebAssembly.instantiateStreaming(fetch('lib.wasm'), go.importObject).then(
        async (result) => {
          mod = result.module
          inst = result.instance
          await go.run(inst)
        }
      )

      function sendInstToGo() {
        sendInst()
      }
    </script>
    <textarea id="inst"></textarea>
    <div>
      <label>AL</label>
      <div id="al" data-value="">0</div>
    </div>

    <div>
      <label>AH</label>
      <div id="ah" data-value="">0</div>
    </div>
    <div>
      <label>B</label>
      <div id="b" data-value="">0</div>
    </div>
    <div>
      <label>C</label>
      <div id="c" data-value="">0</div>
    </div>
    <div>
      <label>D</label>
      <div id="d" data-value="">0</div>
    </div>
    <div>
      <label>E</label>
      <div id="e" data-value="">0</div>
    </div>
    <div>
      <label>L</label>
      <div id="l" data-value="">0</div>
    </div>
    <div>
      <label>H</label>
      <div id="h" data-value="">0</div>
    </div>

    <div>
      <label>IR</label>
      <div id="ir" data-value="">0</div>
    </div>

    <div>
      <label>MAR</label>
      <div id="mar" data-value="">0</div>
    </div>

    <div>
      <label>MBR</label>
      <div id="mbr" data-value="">0</div>
    </div>

    <div>
      <label>PC</label>
      <div id="pc" data-value="">0</div>
    </div>

    <div>
      <label>MEM</label>
      <div id="mem" data-value="">WEll Fuck</div>
    </div>
    <div>
      <label>sp</label>
      <div id="sp" data-value="">0</div>
    </div>
    <div>
      <label>stack mem</label>
      <div id="smem" data-value="">WEll Fuck</div>
    </div>

    <button onClick="sendInstToGo()" id="send">send</button>
    <button onClick="subtract(1,2);" id="sub">sub</button>

    <button onClick="callGoFunction()">some</button>
  </body>
</html>
